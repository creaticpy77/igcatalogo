<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>IG IMPORT - PRODUCTOS ANA HICKMANN</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa;}
    h1 { margin-bottom: 10px; color: #b05eae; }
    #buscar {margin-bottom: 15px; padding: 7px; width: 300px; font-size: 16px;}
    #abrirSeleccionados {margin-bottom: 20px; padding: 10px 15px; background: #b05eae; color: #fff; border:none; border-radius: 4px; cursor:pointer;}
    .producto { border: 1px solid #ddd; margin: 12px 0; padding: 15px; display:flex; align-items:center; background: #fff; border-radius: 8px;}
    .producto img { max-width: 120px; margin-right: 20px; border-radius: 5px; border:1px solid #eee;}
    .info { flex-grow: 1;}
    .info strong {color: #6d28c2;}
    input[type="number"] { width: 60px; font-size: 16px; }
    .producto-select { margin-left: 18px; font-size: 15px;}
    label { margin-bottom: 4px; }
    .pagination { margin-top: 20px; display:flex; align-items: center; gap: 8px;}
    .pagination button { padding: 6px 12px; background: #b05eae; color:#fff; border:none; border-radius:4px; cursor:pointer;}
    .pagination button[disabled] { background: #e0d9e6; color: #999; cursor:default;}
    .pagination select { margin-left: 15px; padding: 4px 8px; }
    .pagina-info {margin-left: 12px; font-weight: bold;}
    @media (max-width:600px) {
      .producto {flex-direction:column; align-items:flex-start;}
      .producto img {margin-bottom: 10px;}
    }
  </style>
</head>
<body>
  <h1>IG IMPORT - PRODUCTOS ANA HICKMANN</h1>
  <input type="text" id="buscar" placeholder="Buscar por modelo..." oninput="filtrarProductos()" autocomplete="off" />
  <br>
  <button id="abrirSeleccionados" onclick="abrirSeleccionados()">Abrir Página con productos seleccionados</button>
  <div id="productos"></div>
  <div class="pagination">
    <button id="first" onclick="goToPage(1)">Inicio</button>
    <button id="prev" onclick="goToPage(currentPage - 1)">Anterior</button>
    <span class="pagina-info" id="pagina-info"></span>
    <button id="next" onclick="goToPage(currentPage + 1)">Siguiente</button>
    <button id="last" onclick="goToPage(totalPages)">Final</button>
    <label for="perPage">Ver</label>
    <select id="perPage" onchange="changePerPage()">
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="30" selected>30</option>
      <option value="50">50</option>
      <option value="100">100</option>
    </select>
    <span>por página</span>
  </div>

<script>
const HOJA_URL = "https://opensheet.elk.sh/1ik07i73RGHhsSCw71oz7-cwqt6g1gMfdjZ9sZDXhgP4/Hoja1";

let productos = [];
let filtrados = [];
let currentPage = 1;
let perPage = 30;
let totalPages = 1;

// --- SELECCIÓN PERSISTENTE ---
function cargarSeleccionadosMem() {
  try {
    return JSON.parse(localStorage.getItem('seleccionadosMem') || '{}');
  } catch {
    return {};
  }
}
function guardarSeleccionadosMem() {
  localStorage.setItem('seleccionadosMem', JSON.stringify(seleccionadosMem));
}
let seleccionadosMem = cargarSeleccionadosMem();
// --------------------------------

function crearElementoProducto(prod, index) {
    const div = document.createElement('div');
    div.className = 'producto';
    div.dataset.modelo = (prod.modelo || '').toLowerCase();

    const img = document.createElement('img');
    img.src = prod.imagesrc;
    img.alt = prod.modelo;

    const info = document.createElement('div');
    info.className = 'info';
    info.innerHTML = `<strong>Marca:</strong> ${prod.marca}<br><strong>Modelo:</strong> ${prod.modelo}`;

    const cantidadLabel = document.createElement('label');
    cantidadLabel.textContent = 'Cantidad: ';
    const cantidadInput = document.createElement('input');
    cantidadInput.type = 'number';
    cantidadInput.min = 1;
    cantidadInput.value = seleccionadosMem[prod.modelo]?.cantidad || 1;
    cantidadInput.className = 'cantidad';
    cantidadInput.setAttribute('data-index', index);

    cantidadInput.onchange = function() {
        if (seleccionadosMem[prod.modelo]) {
            seleccionadosMem[prod.modelo].cantidad = cantidadInput.value;
            guardarSeleccionadosMem();
        }
    };

    cantidadLabel.appendChild(cantidadInput);

    const seleccionarLabel = document.createElement('label');
    seleccionarLabel.className = 'producto-select';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = 'seleccionar';
    checkbox.setAttribute('data-index', index);
    checkbox.checked = !!seleccionadosMem[prod.modelo];

    checkbox.onchange = function() {
        if (checkbox.checked) {
            seleccionadosMem[prod.modelo] = {
                marca: prod.marca,
                modelo: prod.modelo,
                img: prod.imagesrc,
                cantidad: cantidadInput.value
            };
        } else {
            delete seleccionadosMem[prod.modelo];
        }
        guardarSeleccionadosMem();
    };

    seleccionarLabel.appendChild(checkbox);
    seleccionarLabel.appendChild(document.createTextNode(' Seleccionar'));

    div.appendChild(img);
    div.appendChild(info);
    div.appendChild(cantidadLabel);
    div.appendChild(seleccionarLabel);

    return div;
}

function mostrarProductosPagina() {
    const contenedor = document.getElementById('productos');
    contenedor.innerHTML = '';
    let inicio = (currentPage - 1) * perPage;
    let fin = Math.min(inicio + perPage, filtrados.length);
    for (let i = inicio; i < fin; i++) {
        contenedor.appendChild(crearElementoProducto(filtrados[i], i));
    }
    actualizarEstadoPaginacion();
}

function actualizarEstadoPaginacion() {
    totalPages = Math.max(1, Math.ceil(filtrados.length / perPage));
    document.getElementById('first').disabled = currentPage === 1;
    document.getElementById('prev').disabled = currentPage === 1;
    document.getElementById('next').disabled = currentPage === totalPages;
    document.getElementById('last').disabled = currentPage === totalPages;
    document.getElementById('pagina-info').textContent =
      `Página ${currentPage} de ${totalPages} (${filtrados.length} productos)`;
}

function filtrarProductos() {
    const filtro = document.getElementById('buscar').value.toLowerCase();
    filtrados = productos.filter(item => (item.modelo || '').toLowerCase().includes(filtro));
    currentPage = 1;
    mostrarProductosPagina();
}

function goToPage(page) {
    totalPages = Math.max(1, Math.ceil(filtrados.length / perPage));
    if (page < 1) page = 1;
    if (page > totalPages) page = totalPages;
    currentPage = page;
    mostrarProductosPagina();
}

function changePerPage() {
    perPage = parseInt(document.getElementById('perPage').value);
    currentPage = 1;
    mostrarProductosPagina();
}

function abrirSeleccionados() {
    const seleccionados = Object.values(seleccionadosMem);
    localStorage.setItem('productosSeleccionados', JSON.stringify(seleccionados));
    window.open('seleccionados.html', '_blank');
}

// Cargar productos al arrancar
fetch(HOJA_URL)
    .then(response => response.json())
    .then(data => {
        productos = data.filter(item => item.modelo && item.imagesrc);
        filtrados = productos; // al inicio son todos
        mostrarProductosPagina();
    })
    .catch(err => {
        document.getElementById('productos').innerHTML = '<p style="color:red">No se pudo cargar el catálogo.</p>';
        console.error(err);
    });

</script>
</body>
</html>





