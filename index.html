<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>IG IMPORT - PRODUCTOS ANA HICKMANN</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  h1 { margin-bottom: 10px; }
  .producto { border: 1px solid #ccc; margin: 10px 0; padding: 10px; display:flex; align-items:center; }
  .producto img { max-width: 150px; margin-right: 15px; }
  .info { flex-grow: 1; }
  label { display:block; margin-bottom: 5px; }
  input[type="number"] { width: 50px; }
  .producto-select { margin-left: 15px; }
  #buscar { margin-bottom: 15px; padding: 7px; width: 300px; }
  #abrirSeleccionados { margin-bottom: 20px; padding: 10px 15px; }
</style>
</head>
<body>

<h1>IG IMPORT - PRODUCTOS ANA HICKMANN</h1>

<input 
  type="text" 
  id="buscar" 
  placeholder="Buscar por modelo..." 
  oninput="filtrarProductos()" 
/>

<button id="abrirSeleccionados" onclick="abrirSeleccionados()">Abrir PÃ¡gina con productos seleccionados</button>

<div id="productos"></div>

<script>
  const productos = ${JSON.stringify(
    require('fs')
      .readFileSync('ahigfull01.csv', 'utf-8')
      .split('\n')
      .slice(1)
      .filter(line => line.trim())
      .map(line => {
        const [marca, modelo, imagesrc] = line.split(',');
        return { marca, modelo, imagesrc };
      })
  )};

  function crearElementoProducto(prod) {
    const div = document.createElement('div');
    div.className = 'producto';
    div.dataset.modelo = prod.modelo.toLowerCase();

    const img = document.createElement('img');
    img.src = prod.imagesrc;
    img.alt = prod.modelo;
    
    const info = document.createElement('div');
    info.className = 'info';
    info.innerHTML = `<strong>Marca: </strong>${prod.marca}<br><strong>Modelo: </strong>${prod.modelo}`;

    const cantidadLabel = document.createElement('label');
    cantidadLabel.textContent = 'Cantidad: ';
    const cantidadInput = document.createElement('input');
    cantidadInput.type = 'number';
    cantidadInput.min = 1;
    cantidadInput.value = 1;
    cantidadInput.className = 'cantidad';
    cantidadLabel.appendChild(cantidadInput);

    const seleccionarLabel = document.createElement('label');
    seleccionarLabel.className = 'producto-select';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = 'seleccionar';
    seleccionarLabel.appendChild(checkbox);
    seleccionarLabel.appendChild(document.createTextNode(' Seleccionar'));

    div.appendChild(img);
    div.appendChild(info);
    div.appendChild(cantidadLabel);
    div.appendChild(seleccionarLabel);

    return div;
  }

  function cargarProductos() {
    const contenedor = document.getElementById('productos');
    contenedor.innerHTML = '';
    productos.forEach(prod => {
      contenedor.appendChild(crearElementoProducto(prod));
    });
  }

  function filtrarProductos() {
    const filtro = document.getElementById('buscar').value.toLowerCase();
    document.querySelectorAll('.producto').forEach(div => {
      const modelo = div.dataset.modelo;
      div.style.display = modelo.includes(filtro) ? 'flex' : 'none';
    });
  }

  function abrirSeleccionados() {
    const seleccionados = [];
    document.querySelectorAll('.producto').forEach(div => {
      const checkbox = div.querySelector('.seleccionar');
      if (checkbox.checked) {
        const marca = div.querySelector('.info').innerHTML.match(/Marca: <\/strong>(.*?)<br>/)[1];
        const modelo = div.querySelector('.info').innerHTML.match(/Modelo: <\/strong>(.*)/)[1];
        const img = div.querySelector('img').src;
        const cantidad = div.querySelector('.cantidad').value || 1;
        seleccionados.push({ marca, modelo, img, cantidad });
      }
    });
    localStorage.setItem('productosSeleccionados', JSON.stringify(seleccionados));
    window.open('seleccionados.html', '_blank');
  }

  cargarProductos();
</script>

</body>
</html>
