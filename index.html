<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>IG IMPORT - PRODUCTOS ANA HICKMANN</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa;}
    h1 { margin-bottom: 10px; color: #b05eae; }
    #buscar {margin-bottom: 15px; padding: 7px; width: 300px; font-size: 16px;}
    #abrirSeleccionados {margin-bottom: 20px; padding: 10px 15px; background: #b05eae; color: #fff; border:none; border-radius: 4px; cursor:pointer;}
    .producto { border: 1px solid #ddd; margin: 12px 0; padding: 15px; display:flex; align-items:center; background: #fff; border-radius: 8px;}
    .producto img { max-width: 120px; margin-right: 20px; border-radius: 5px; border:1px solid #eee;}
    .info { flex-grow: 1;}
    .info strong {color: #6d28c2;}
    input[type="number"] { width: 60px; font-size: 16px; }
    .producto-select { margin-left: 18px; font-size: 15px;}
    label { margin-bottom: 4px; }
    @media (max-width:600px) {
      .producto {flex-direction:column; align-items:flex-start;}
      .producto img {margin-bottom: 10px;}
    }
  </style>
</head>
<body>
  <h1>IG IMPORT - PRODUCTOS ANA HICKMANN</h1>
  <input type="text" id="buscar" placeholder="Buscar por modelo..." oninput="filtrarProductos()" autocomplete="off" />
  <br>
  <button id="abrirSeleccionados" onclick="abrirSeleccionados()">Abrir Página con productos seleccionados</button>
  <div id="productos"></div>

<script>
const HOJA_URL = "https://opensheet.elk.sh/1ik07i73RGHhsSCw71oz7-cwqt6g1gMfdjZ9sZDXhgP4/Hoja1";

let productos = [];

function crearElementoProducto(prod, index) {
    const div = document.createElement('div');
    div.className = 'producto';
    div.dataset.modelo = (prod.modelo || '').toLowerCase();

    const img = document.createElement('img');
    img.src = prod.imagesrc;
    img.alt = prod.modelo;

    const info = document.createElement('div');
    info.className = 'info';
    info.innerHTML = `<strong>Marca:</strong> ${prod.marca}<br><strong>Modelo:</strong> ${prod.modelo}`;

    const cantidadLabel = document.createElement('label');
    cantidadLabel.textContent = 'Cantidad: ';
    const cantidadInput = document.createElement('input');
    cantidadInput.type = 'number';
    cantidadInput.min = 1;
    cantidadInput.value = 1;
    cantidadInput.className = 'cantidad';
    cantidadInput.setAttribute('data-index', index);
    cantidadLabel.appendChild(cantidadInput);

    const seleccionarLabel = document.createElement('label');
    seleccionarLabel.className = 'producto-select';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = 'seleccionar';
    checkbox.setAttribute('data-index', index);
    seleccionarLabel.appendChild(checkbox);
    seleccionarLabel.appendChild(document.createTextNode(' Seleccionar'));

    div.appendChild(img);
    div.appendChild(info);
    div.appendChild(cantidadLabel);
    div.appendChild(seleccionarLabel);

    return div;
}

function mostrarProductos(arr) {
    const contenedor = document.getElementById('productos');
    contenedor.innerHTML = '';
    arr.forEach((prod, idx) => {
        contenedor.appendChild(crearElementoProducto(prod, idx));
    });
}

function filtrarProductos() {
    const filtro = document.getElementById('buscar').value.toLowerCase();
    document.querySelectorAll('.producto').forEach(div => {
        const modelo = div.dataset.modelo;
        div.style.display = modelo.includes(filtro) ? 'flex' : 'none';
    });
}

function abrirSeleccionados() {
    const seleccionados = [];
    document.querySelectorAll('.producto').forEach((div, idx) => {
        const checkbox = div.querySelector('.seleccionar');
        if (checkbox.checked) {
            const marca = productos[idx].marca;
            const modelo = productos[idx].modelo;
            const img = productos[idx].imagesrc;
            const cantidad = div.querySelector('.cantidad').value || 1;
            seleccionados.push({ marca, modelo, img, cantidad });
        }
    });
    localStorage.setItem('productosSeleccionados', JSON.stringify(seleccionados));
    window.open('seleccionados.html', '_blank');
}

// ¡NUEVO! Traemos productos al cargar:
fetch(HOJA_URL)
    .then(response => response.json())
    .then(data => {
        // Filtra vacíos y filas sin modelo
        productos = data.filter(item => item.modelo && item.imagesrc);
        mostrarProductos(productos);
    })
    .catch(err => {
        document.getElementById('productos').innerHTML = '<p style="color:red">No se pudo cargar el catálogo.</p>';
        console.error(err);
    });

</script>
</body>
</html>


