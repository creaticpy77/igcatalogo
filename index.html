<script>
const HOJA_URL = "https://opensheet.elk.sh/1ik07i73RGHhsSCw71oz7-cwqt6g1gMfdjZ9sZDXhgP4/Hoja1";

let productos = [];

function crearElementoProducto(prod, index) {
    const div = document.createElement('div');
    div.className = 'producto';
    div.dataset.modelo = (prod.modelo || '').toLowerCase();

    const img = document.createElement('img');
    img.src = prod.imagesrc;
    img.alt = prod.modelo;

    const info = document.createElement('div');
    info.className = 'info';
    info.innerHTML = `<strong>Marca:</strong> ${prod.marca}<br><strong>Modelo:</strong> ${prod.modelo}`;

    const cantidadLabel = document.createElement('label');
    cantidadLabel.textContent = 'Cantidad: ';
    const cantidadInput = document.createElement('input');
    cantidadInput.type = 'number';
    cantidadInput.min = 1;
    cantidadInput.value = 1;
    cantidadInput.className = 'cantidad';
    cantidadInput.setAttribute('data-index', index);
    cantidadLabel.appendChild(cantidadInput);

    const seleccionarLabel = document.createElement('label');
    seleccionarLabel.className = 'producto-select';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = 'seleccionar';
    checkbox.setAttribute('data-index', index);
    seleccionarLabel.appendChild(checkbox);
    seleccionarLabel.appendChild(document.createTextNode(' Seleccionar'));

    div.appendChild(img);
    div.appendChild(info);
    div.appendChild(cantidadLabel);
    div.appendChild(seleccionarLabel);

    return div;
}

function mostrarProductos(arr) {
    const contenedor = document.getElementById('productos');
    contenedor.innerHTML = '';
    arr.forEach((prod, idx) => {
        contenedor.appendChild(crearElementoProducto(prod, idx));
    });
}

function filtrarProductos() {
    const filtro = document.getElementById('buscar').value.toLowerCase();
    document.querySelectorAll('.producto').forEach(div => {
        const modelo = div.dataset.modelo;
        div.style.display = modelo.includes(filtro) ? 'flex' : 'none';
    });
}

function abrirSeleccionados() {
    const seleccionados = [];
    document.querySelectorAll('.producto').forEach((div, idx) => {
        const checkbox = div.querySelector('.seleccionar');
        if (checkbox.checked) {
            const marca = productos[idx].marca;
            const modelo = productos[idx].modelo;
            const img = productos[idx].imagesrc;
            const cantidad = div.querySelector('.cantidad').value || 1;
            seleccionados.push({ marca, modelo, img, cantidad });
        }
    });
    localStorage.setItem('productosSeleccionados', JSON.stringify(seleccionados));
    window.open('seleccionados.html', '_blank');
}

// ¡NUEVO! Traemos productos al cargar:
fetch(HOJA_URL)
    .then(response => response.json())
    .then(data => {
        // Filtra vacíos y filas sin modelo
        productos = data.filter(item => item.modelo && item.imagesrc);
        mostrarProductos(productos);
    })
    .catch(err => {
        document.getElementById('productos').innerHTML = '<p style="color:red">No se pudo cargar el catálogo.</p>';
        console.error(err);
    });
</script>

